<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Huan's Adventure Map</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jim+Nightshade&family=UnifrakturMaguntia&family=ZCOOL+XiaoWei&family=Pirata+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-parchment: #f3eacb;
            --bg-card: #fffef0;
            --ink-color: #2c241b;
            --ink-light: #5c4d3c;
            --accent-red: #8a2c2c;
            --border-color: #8b7355;
            
            /* å­—ä½“å˜é‡ */
            --font-title-fancy: 'UnifrakturMaguntia', cursive; 
            --font-body-en: 'Jim Nightshade', cursive; 
            --font-body-zh: 'ZCOOL XiaoWei', serif;
            --font-stats: 'Pirata One', cursive;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: #1a1a1a;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: var(--font-body-en);
            color: var(--ink-color);
        }

        /* è¯­è¨€åˆ‡æ¢é€»è¾‘ */
        .content-en { display: none; }
        body.lang-en .content-en { display: block; }
        body.lang-en .content-zh { display: none; }

        /* è¯­è¨€åˆ‡æ¢æŒ‰é’® */
        .lang-switch {
            position: fixed;
            top: 20px; right: 20px; z-index: 10001;
            padding: 8px 12px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            cursor: pointer;
            font-family: var(--font-body-zh);
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }

        /* åœ°å›¾è§†å£ */
        .map-viewport {
            position: relative;
            width: 100%; height: 100%;
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            cursor: grab;
            background: #d4c5a3;
        }

        /* èƒŒæ™¯åœ°å›¾å±‚ */
        .map-layer {
    background-repeat: no-repeat;
    position: relative;
    display: block;
    background-image: url(https://i.redd.it/36tc6drz7gu51.jpg);
    background-size: cover;
    /* background-position: center; */
    filter: sepia(0.3) contrast(1.1);
    /* min-width: 1600px; */
    min-height: 1200px;        }

        /* å…¨å±æš—è§’é®ç½© */
        .vignette-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none; z-index: 5;
            background: radial-gradient(circle at center, transparent 60%, rgba(43, 32, 24, 0.4) 100%);
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
        }

        /* ------ å›¾æ ‡æ ‡è®° (Marker) ------ */
        .marker {
            position: absolute;
            width: 90px; height: 90px;
            z-index: 10;
            transform: translate(-50%, -50%);
            cursor: pointer;
            animation: float 3s ease-in-out infinite;
        }
        .marker:hover { filter: drop-shadow(0 0 8px rgba(255, 250, 240, 0.6)); }
        .marker:hover,
.marker.active {
    z-index: 9999 !important; /* è®©å½“å‰æ“ä½œçš„è¿™ä¸ªå›¾æ ‡ï¼Œå‡Œé©¾äºæ‰€æœ‰å…¶ä»–å›¾æ ‡ä¹‹ä¸Š */
}

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-5px); }
        }

        .marker-icon {
            width: 100%; height: 100%;
            fill: var(--ink-color);
            stroke: var(--bg-card); 
            stroke-width: 1.5;
            transition: transform 0.2s;
        }
        @media (min-width: 769px) {
            .marker:hover .marker-icon { transform: scale(1.1); }
        }
        .mage-img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.8));
            transition: transform 0.2s;
        }
        .marker:hover .mage-img { transform: scale(1.1) rotate(-5deg); }

        /* ------ å¡ç‰‡å¼¹çª— (Card Popup) ------ */
        .card-popup {
            position: absolute;
            z-index: 100;
            background-color: var(--bg-card);
            
            /* åä¸½è¾¹æ¡†è®¾è®¡ */
            border: 3px double var(--border-color);
            outline: 1px solid var(--border-color);
            outline-offset: 4px;
            
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            
            opacity: 0; visibility: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            pointer-events: none;
            position: fixed; /* å…³é”®ç‚¹ 1 */
            left: 0;         /* å…³é”®ç‚¹ 2 */
            right: 0;        /* å…³é”®ç‚¹ 3 */
            width: 100vw;    /* å…³é”®ç‚¹ 4 */
        }

        /* è£…é¥°æ€§è§’æ ‡ */
        .card-popup::before, .card-popup::after {
            position: absolute;
            font-family: serif; font-size: 24px;
            color: var(--border-color); line-height: 1;
        }
        .card-popup::before { content: "âœ¥"; top: 3px; left: 3px; }
        .card-popup::after { content: "âœ¥"; bottom: 3px; right: 3px; }

        /* ç”µè„‘ç«¯å¡ç‰‡æ ·å¼ */
       /* ğŸ’» ç”µè„‘ç«¯é€‚é… (Desktop) */
@media (min-width: 769px) {
    .card-popup {
        bottom: 80px; 
        left: 50%;
        transform: translateX(-50%);
        width: 350px;
        padding: 25px 20px;
    }
    
    .marker:hover .card-popup {
        opacity: 1; 
        visibility: visible;
        pointer-events: auto;
        transform: translateX(-50%) translateY(-10px);
    }
}
        /* ------ å†…å®¹æ’ç‰ˆ ------ */
        .card-title {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 5px;
            border-bottom: 1px solid var(--ink-light);
            padding-bottom: 10px;
            color: var(--accent-red);
        }
        .card-title.content-zh { font-family: var(--font-body-zh); font-weight: bold; }
        .card-title.content-en { font-family: var(--font-title-fancy); letter-spacing: 1px; }

        .card-subtitle {
            font-size: 1.2rem; text-align: center;
            color: var(--ink-light); margin-bottom: 15px;
        }
        .card-subtitle.content-zh { font-family: var(--font-body-zh); }
        .card-subtitle.content-en { font-family: var(--font-body-en); font-style: normal; font-size: 1.4rem; }

        .card-content { font-size: 1.15rem; line-height: 1.5; }
        .card-content .content-zh { font-family: var(--font-body-zh); }
        /* è‹±æ–‡æ­£æ–‡ä½¿ç”¨ Jim Nightshadeï¼Œç¨å¾®åŠ å¤§å­—å·ä»¥ä¿è¯æ˜“è¯»æ€§ */
        .card-content .content-en { font-family: var(--font-body-en); font-size: 1.4rem; }

        .stats-row { display: flex; justify-content: space-around; margin: 15px 0; border-top: 1px dashed var(--ink-light); border-bottom: 1px dashed var(--ink-light); padding: 10px 0;}
        .stat-item { text-align: center; }
        .stat-item label { font-size: 0.9rem; display: block; font-weight: bold; font-family: var(--font-stats); letter-spacing: 1px;}
        .stat-item span { font-size: 1.5rem; font-family: var(--font-stats); }

        .link-list { list-style: none; margin-top: 10px; }
        .link-list a { text-decoration: none; color: var(--ink-color); display: flex; align-items: center; padding: 8px 0; transition: color 0.2s; border-bottom: 1px dotted rgba(0,0,0,0.1);}
        .link-list a:hover { color: var(--accent-red); }
        .link-list .content-zh { font-family: var(--font-body-zh); font-size: 1.1rem;}
        .link-list .content-en { font-family: var(--font-body-en); font-size: 1.4rem; }


        /* ========================================= */
        /* ğŸ“± ç§»åŠ¨ç«¯æ·±åº¦é€‚é… (Mobile Optimization)   */

@media (max-width: 768px) {
    
    /* 1. åœ°å›¾é“ºæ»¡ */
    .map-layer {
        min-width: 100%; min-height: 100%;
        width: 100vw; height: 100vh;
        background-size: cover; 
        background-position: center;
    }

    /* 2. å›¾æ ‡ä¿®å¤ï¼šè§£é™¤åŠ¨ç”»é™åˆ¶ */
    .marker { 
        width: 80px; height: 80px;
        transform: none !important; 
        animation: none !important; 
        margin-left: -40px; 
        margin-top: -40px; 
        pointer-events: auto;
    }
    
    .marker:hover { filter: none !important; }
    .marker:hover .marker-icon { transform: none !important; }
    .marker:hover .mage-img { transform: none !important; }

    .marker:hover .card-popup { 
        opacity: 0 !important; 
        visibility: hidden !important; 
    }

    /* 3. å¡ç‰‡æ ·å¼ï¼š80% å®½åº¦ + å±…ä¸­ + åº•éƒ¨æ‚¬æµ® */
    .card-popup {
        position: fixed; 
        top: auto; 
        bottom: 30px; /* ç¦»åº•éƒ¨ç•™ä¸€ç‚¹ç©ºéš™ï¼Œåƒä¸ªæµ®åŠ¨çš„å¡ç‰‡ */
        
        /* æ ¸å¿ƒä¿®æ”¹ï¼šå®ç° 80% å®½åº¦å¹¶å±…ä¸­ */
        left: 50% !important;  /* å…ˆå®šåœ¨å±å¹•æ­£ä¸­é—´ */
        width: 80vw !important; /* å®½åº¦è®¾ä¸ºè§†å£å®½åº¦çš„ 80% */
        margin: 0 !important;
        
        /* é»˜è®¤éšè—çŠ¶æ€ï¼šå‘ä¸‹ä½ç§» 120% + æ°´å¹³å±…ä¸­ä¿®æ­£ (-50%) */
        transform: translate(-50%, 120%); 
        
        border-radius: 20px; /* å››å‘¨éƒ½å˜æˆåœ†è§’ */
        padding: 30px 20px; 
        
        outline: none;
        border-left: none; border-right: none;
        border-top: 4px double var(--border-color);
        border-bottom: 4px double var(--border-color); /* åº•éƒ¨ä¹ŸåŠ å›è¾¹æ¡†ï¼Œå› ä¸ºæ‚¬ç©ºäº† */
        
        max-height: 70vh; /* é˜²æ­¢å¤ªé«˜æŒ¡ä½åœ°å›¾ */
        overflow-y: auto;
    }

    /* 4. æ¿€æ´»çŠ¶æ€ (Active) */
    .marker.active .card-popup {
        opacity: 1 !important; 
        visibility: visible !important;
        /* æ¿€æ´»æ˜¾ç¤ºï¼šæ°´å¹³å±…ä¸­ (-50%) + å‚ç›´å½’ä½ (0) */
        transform: translate(-50%, 0) !important; 
        pointer-events: auto;
    }

    /* å­—ä½“ä¸é—´è·é€‚é… */
    .card-title { font-size: 1.6rem; }
    .card-content .content-zh { font-size: 1rem; }
    .card-content .content-en { font-size: 1.3rem; } 
    .stats-row { gap: 10px; }
    .stat-item span { font-size: 1.8rem; }
    .link-list a { padding: 10px 0; }
    .lang-switch { top: 15px; right: 15px; padding: 6px 10px; }
}
    </style>
</head>
<body class="lang-zh">

    <div class="lang-switch" onclick="switchLanguage()">
        <span class="content-zh"> EN </span>
        <span class="content-en"> ä¸­æ–‡ </span>
    </div>

    <div class="vignette-overlay"></div>

    <div class="map-viewport" id="mapContainer">
        <div class="map-layer">
            
           <div class="marker" style="top: 50%; left: 50%;" onclick="togglePopup(this)">
                <img src="mage.png" class="mage-img" alt="Mage">

                <div class="card-popup">
                    <div class="card-title content-zh">å†’é™©è€…æ¡£æ¡ˆ</div>
                    <div class="card-title content-en">Adventurer Profile</div>
                    
                    <div class="card-subtitle content-zh">Huan the Nerd (Lv 10)</div>
                    <div class="card-subtitle content-en">Human the Nerd (Lv 10)</div>
                    
                    <div class="card-content">
                        <p class="content-zh">å¸¦æœ‰â€œé‡‘é±¼çš„è®°å¿†â€è¯…å’’çš„å†’é™©è€…ï¼Œç¾½æ¯›çƒé…éŸ³æ¼”å‘˜ï¼Œè¿‡å»åå¹´åšå¾—æœ€å¤šçš„æ˜¯ç¿»è¯‘/æœ¬åœ°åŒ–</p>
                        <p class="content-en">An adventurer cusrsed with the Memory of a Goldfish, voice actress for badminton games, translator for the past decade.</p>
                        
                        <div class="stats-row">
                            <div class="stat-item"><label>STR</label><span>16</span></div>
                            <div class="stat-item"><label>CON</label><span>14</span></div> 
                            <div class="stat-item"><label>CHA</label><span>12</span></div>
                        </div>

                        <p style="text-align:center; margin-top:10px;">
                            <span class="content-zh">â¤ é­”å® ï¼šç™½çŒ«å›§å›§</span>
                            <span class="content-en">â¤ Familiar: Jiong Jiong (å›§å›§)</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="marker" style="top: 30%; left: 30%;" onclick="togglePopup(this)">
                <svg class="marker-icon" viewBox="0 0 100 100" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="50" cy="50" r="45" fill="#f3eacb" stroke-width="2"/>
                    <rect x="25" y="30" width="50" height="40" rx="5" fill="#fffef0" stroke="#2c241b" stroke-width="2"/>
                    <rect x="20" y="30" width="5" height="40" fill="#8b7355"/>
                    <rect x="75" y="30" width="5" height="40" fill="#8b7355"/>
                    <path d="M75 25 L85 15 L85 20 L75 30 Z" fill="#2c241b" stroke="none"/>
                    <line x1="75" y1="25" x2="60" y2="40" stroke="#2c241b" stroke-width="2"/>
                </svg>

                <div class="card-popup">
                    <div class="card-title content-zh">å·è½´</div>
                    <div class="card-title content-en">Scrolls</div>
                    
                    <div class="card-content">
                        <p class="content-zh">è¿™é‡Œå­˜æ”¾ç€å…³äºæŠ€æœ¯ä¸å“²å­¦çš„æ€è€ƒè®°å½•ã€‚</p>
                        <p class="content-en">Records of thoughts on technology and philosophy.</p>
                        <ul class="link-list">
                            <li><a href="#"><span class="content-zh">âœ¦ æ¢¦å¸</span><span class="content-en">âœ¦ Dreams</span></a></li>
                            <li><a href="#"><span class="content-zh">âœ¦ è·‘å›¢æˆ˜æŠ¥</span><span class="content-en">âœ¦ D&D Adventure Logs</span></a></li>
                            <li><a href="#"><span class="content-zh">âœ¦ AIè¾…åŠ©ç¿»è¯‘ä½œå“</span><span class="content-en">âœ¦ AI-enhanced Translations</span></a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="marker" style="top: 70%; left: 70%;" onclick="togglePopup(this)">
                <svg class="marker-icon" viewBox="0 0 100 100" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="50" cy="50" r="45" fill="#f3eacb" stroke-width="2"/>
                    <circle cx="50" cy="35" r="25" fill="#fffef0" stroke="#2c241b" stroke-width="2"/>
                    <path d="M30 60 L70 60 L65 70 L35 70 Z" fill="#8b7355" stroke="#2c241b" stroke-width="1"/>
                    <circle cx="55" cy="30" r="5" fill="#f3eacb" opacity="0.8"/>
                </svg>

                <div class="card-popup">
                    <div class="card-title content-zh">è®°å¿†ç¢ç‰‡</div>
                    <div class="card-title content-en">Crystal Visions</div>
                    
                    <div class="card-content">
                        <p class="content-zh">é€è¿‡æ°´æ™¶çƒï¼Œä½ å¯ä»¥çœ‹åˆ°è¿‡å»çš„å½±åƒã€‚</p>
                        <p class="content-en">View images and recordings from the past.</p>
                        <ul class="link-list">
                            <li><a href="#"><span class="content-zh">âœ¦ [ç›¸å†Œ] é­”å® </span><span class="content-en">âœ¦ [Gallery] Familiar</span></a></li>
                            <li><a href="story-dany.html"><span class="content-zh">âœ¦ ç²¾é€‰å†…å®¹</span><span class="content-en">âœ¦ Selects</span></a></li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        let currentLang = 'zh';

        function switchLanguage() {
            const body = document.body;
            currentLang = body.classList.contains('lang-zh') ? 'en' : 'zh';
            body.classList.remove('lang-zh', 'lang-en');
            body.classList.add(`lang-${currentLang}`);
            // åˆ‡æ¢è¯­è¨€æ—¶å…³é—­å¼¹çª—
            document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('lang-zh'); 
        });

        function togglePopup(element) {
            event.stopPropagation(); // é˜²æ­¢å†’æ³¡è§¦å‘èƒŒæ™¯å…³é—­
            
            const isActive = element.classList.contains('active');
            
            // 1. å…ˆå…³é—­æ‰€æœ‰å¼¹çª—
            document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
            
            // 2. å¦‚æœåˆšæ‰æ²¡æ¿€æ´»ï¼Œç°åœ¨å°±æ¿€æ´» (å®ç°ç‚¹å‡»å¼€å…³ toggle æ•ˆæœ)
            if (!isActive) {
                element.classList.add('active');
            }
        }

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­æ‰€æœ‰å¼¹çª—
        document.getElementById('mapContainer').addEventListener('click', function() {
            document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
        });
    </script>
</body>
</html>